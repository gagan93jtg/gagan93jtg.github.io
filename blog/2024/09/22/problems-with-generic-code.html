<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZKG2EDMK4C"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-ZKG2EDMK4C');
      </script>
    

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/blog/assets/css/styles.css">
  </head><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Problems with generic code | Gagandeep Singh ‚Äî Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Problems with generic code" />
<meta name="author" content="Gagandeep Singh" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I try to explain the pitfalls of overly generic code and why it‚Äôs beneficial to avoid it. I share my experiences and lessons learned over the years. I explain how generic code can become a maintenance nightmare in the long run.." />
<meta property="og:description" content="I try to explain the pitfalls of overly generic code and why it‚Äôs beneficial to avoid it. I share my experiences and lessons learned over the years. I explain how generic code can become a maintenance nightmare in the long run.." />
<link rel="canonical" href="https://gagan93.me/blog/2024/09/22/problems-with-generic-code.html" />
<meta property="og:url" content="https://gagan93.me/blog/2024/09/22/problems-with-generic-code.html" />
<meta property="og:site_name" content="Gagandeep Singh ‚Äî Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-22T00:00:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Problems with generic code" />
<script type="application/ld+json">
{"headline":"Problems with generic code","dateModified":"2024-09-22T00:00:00+05:30","datePublished":"2024-09-22T00:00:00+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"https://gagan93.me/blog/2024/09/22/problems-with-generic-code.html"},"author":{"@type":"Person","name":"Gagandeep Singh"},"@type":"BlogPosting","description":"I try to explain the pitfalls of overly generic code and why it‚Äôs beneficial to avoid it. I share my experiences and lessons learned over the years. I explain how generic code can become a maintenance nightmare in the long run..","url":"https://gagan93.me/blog/2024/09/22/problems-with-generic-code.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://gagan93.me/blog/feed.xml" title="Gagandeep Singh ‚Äî Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Gagandeep Singh ‚Äî Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post detailed">
  <div class="post-container">
    <p class="author-title">
      Published 22nd September, 2024
    </p>
    <p class="post-title">Problems with generic code</p>

    
    <div class="post-tags">
      
      
        <a href="/blog/categories/#generic-code" class="category">generic-code</a>
        &nbsp;
      
        <a href="/blog/categories/#refactoring" class="category">refactoring</a>
        &nbsp;
      
        <a href="/blog/categories/#solid" class="category">solid</a>
        
      
    </div>
  </div>

  <div class="separator">
    <hr>
  </div>
  <div class="entry">
    <h2 style="box-shadow: rgba(0, 0, 0, 0.24) 0px 5px 3px;"><img src="/blog/assets/images/2024-09-24-generic-code.jpg" alt="cover-photo" /></h2>

<h2 style="text-align: center;font-size: 0.8em" id="photo-by-kier-in-sight-archives-on-unsplash">Photo by <a href="https://unsplash.com/@kierinsightarchives?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Kier in Sight Archives</a> on <a href="https://unsplash.com/photos/black-and-white-heart-sketch-4bhhwmsYl-c?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a></h2>

<h2 id="background">Background</h2>

<p>I‚Äôm a Senior Engineer with nearly 9 years of experience in the Software Industry. In my first year at my previous job, I had to migrate the background job processing engine from <a href="https://github.com/collectiveidea/delayed_job">delayed-job</a> to <a href="https://github.com/sidekiq/sidekiq/">sidekiq</a>. For those not familiar with Ruby, think of these as two libraries that help you run async jobs in a distributed system, similar to <a href="https://www.jobrunr.io/en/">JobRunr</a> in Java projects or <a href="https://docs.celeryq.dev/en/stable/">Celery</a> in Python projects. We encountered several issues with delayed-job and realized that Sidekiq would be a much better option as we scaled. To summarize:</p>

<ol>
  <li>
    <p>Sidekiq runs multiple threads per process to execute jobs, while Delayed Job runs one thread per process. This means Delayed Job uses more memory.</p>
  </li>
  <li>
    <p>Delayed Job uses SQL databases to store jobs, whereas Sidekiq uses Redis. Redis, being an in-memory database, is much faster than traditional disk-based SQL databases.</p>
  </li>
  <li>
    <p>Sidekiq is a very popular Ruby library, so there are many extensions available. These include <a href="https://github.com/sidekiq-cron/sidekiq-cron">running crons</a> and ensuring <a href="https://github.com/mhenrixon/sidekiq-unique-jobs">unique jobs</a>. Additionally, Sidekiq‚Äôs author has <a href="https://github.com/sidekiq/sidekiq/wiki/Using-Dragonfly">started supporting</a> a drop-in <a href="https://www.mikeperham.com/2024/02/01/supporting-dragonfly/">replacement for Redis</a> for storing jobs.</p>
  </li>
  <li>
    <p>While many open-source extensions exist for Sidekiq, companies can get more features and premium support with <a href="https://sidekiq.org/products/pro.html">Sidekiq Pro</a>.</p>
  </li>
</ol>

<h2 id="migration-phase">Migration phase</h2>

<p>We added both libraries together for a few months and gradually migrated from DJ to Sidekiq. The two most common uses of background jobs were:</p>

<ol>
  <li>
    <p>Calling an instance method asynchronously, like loading a model entry from the database and calling a method on it asynchronously (e.g., <code class="language-plaintext highlighter-rouge">Model.find(some_id).process_it_async</code>).</p>
  </li>
  <li>
    <p>Calling a class method asynchronously, which might initialize more classes or call methods as needed (e.g., <code class="language-plaintext highlighter-rouge">SomeClass.process_class_method_async(some_data</code>).)</p>
  </li>
</ol>

<p>At that time, I was a typical <strong>startup engineer</strong> with limited knowledge of code quality, focused primarily on <strong>getting things done.</strong> Consequently, I wrote a small class that facilitated the migration of many usages to Sidekiq:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GenericAsyncWorker</span>
  <span class="kp">include</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Worker</span>

  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="nb">method</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="n">klass</span><span class="p">.</span><span class="nf">constantize</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="ss">:id</span><span class="p">]).</span><span class="nf">send</span><span class="p">(</span><span class="nb">method</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">klass</span><span class="p">.</span><span class="nf">constantize</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is not the exact code but gives an idea of what I wrote. In short:</p>

<ol>
  <li>
    <p>If <code class="language-plaintext highlighter-rouge">args</code> had an <code class="language-plaintext highlighter-rouge">id</code>, I loaded the model object and called <code class="language-plaintext highlighter-rouge">method</code> on it.</p>
  </li>
  <li>
    <p>If not, I called the <code class="language-plaintext highlighter-rouge">class method</code> with the given <code class="language-plaintext highlighter-rouge">args</code>.</p>
  </li>
</ol>

<p>For non-Ruby developers:</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">include Sidekiq::Worker</code> makes this class a background job processor.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">find</code> loads a table row from the database based on ID. It‚Äôs part of Rails‚Äô ORM.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">send</code> dynamically calls methods of a class.</p>
  </li>
</ol>

<p>There was a very kind Senior Engineer who reviewed my code later and said, ‚Äú<em>this is not good, this is too generic</em>.‚Äù I didn‚Äôt understand what they meant at the time. My thought process was ‚Äî <em>it‚Äôs working and it helped complete the migration faster, so what‚Äôs the problem?</em></p>

<p>Before you read on, take a moment to think about whether this is good or bad.</p>

<h2 id="the-problems">The Problems</h2>

<p>Even though the code above works, it breaks key principles of good, maintainable code:</p>

<ol>
  <li>
    <p>According to the <strong>S</strong> in <strong>SOLID</strong> principles, a class should have one reason to change. I also apply this to methods ‚Äî a method should do one thing well. This method is trying to do two things. You might think the method is small and only doing two things, so what‚Äôs the issue? Read on to understand.</p>
  </li>
  <li>
    <p>The code inside the <code class="language-plaintext highlighter-rouge">if</code> statement expects to load the model object and then call <code class="language-plaintext highlighter-rouge">method</code> on it. What if someone wants to pass arguments to that <code class="language-plaintext highlighter-rouge">method</code>? Would we add another argument or <code class="language-plaintext highlighter-rouge">if</code> statement to handle that?</p>
  </li>
  <li>
    <p>What if this class is a plain Ruby class (not a Rails model) that needs to initialize the constructor and then call the <code class="language-plaintext highlighter-rouge">method</code>? Another flag to handle that?</p>
  </li>
  <li>
    <p>As you might know, we assign <strong>queues</strong> to process <strong>specific jobs</strong>. Queues are chosen based on the urgency of the task. If many tasks start running with this generic code, how do we determine the urgency of this job class?</p>
  </li>
</ol>

<p>By just looking at the code for a minute, I quickly spotted these problems. I laugh now, thinking I wrote this back in 2019. But that‚Äôs a good sign because if you don‚Äôt like your old code, it means you‚Äôve grown üòá.</p>

<p>The above is an example of <strong>Generic Code.</strong> Such classes evolve into <a href="https://refactoring.guru/smells/long-method">long methods</a> with a <a href="https://refactoring.guru/smells/long-parameter-list">lot of arguments</a>, creating a mess. Over time, multiple developers change the code in these classes to fit new use-cases, often breaking existing ones. There are only two ways to solve such problems:</p>

<ol>
  <li>
    <p>Don‚Äôt create such classes in the first place.</p>
  </li>
  <li>
    <p>Gradually move to specific classes and delete the old one later.</p>
  </li>
</ol>

<p>I don‚Äôt suggest spending time untangling the mess built up over the years by different developers unless you have test cases for this class. It‚Äôs better to create specific classes for each use case and migrate to them.</p>

<h3 id="lets-talk-about-testing">Let‚Äôs talk about testing</h3>

<p><strong>Note</strong>: Many developers and teams don‚Äôt write unit tests. If you‚Äôre one of them, I strongly recommend you start. They make future maintenance easier and provide feedback on your design.</p>

<p>If you write tests regularly, you‚Äôll see that this class is hard to test. The reason is simple - it has a lot of generic behavior, making it difficult to identify all the combinations you need to test. From my experience, <strong>if a class is hard to test, it likely needs refactoring</strong>.</p>

<h3 id="generic-code-in-production">Generic code in production</h3>

<p>I still see developers writing generic code for production projects. This isn‚Äôt necessarily a problem, as they are on the same learning journey I once experienced. When I encounter this, I take the time to discuss it with them. I schedule a call to explain the pitfalls of overly generic code and why it‚Äôs beneficial to avoid it. I emphasize the importance of writing specific, maintainable code. I share my experiences and lessons learned over the years. I explain how generic code can become a maintenance nightmare in the long run.</p>

<h2 id="conclusion">Conclusion</h2>

<p>By writing specific classes, developers can create more targeted unit tests, which provide better feedback on the design and functionality of the code. Always think about the long-term implications of your code. Writing generic code might seem efficient at first, but it often leads to more work as the codebase evolves and new use cases emerge. By writing specific, well-structured code from the start, we can save ourselves and our teams a lot of future headaches. This post aims to help you understand the value of writing clean, maintainable code and become better software engineers.</p>

  </div>
  <br>

  <div>
    <p>
      <span class="share-box">Share:</span>
      <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
      <script type="IN/Share" data-url="https://gagan93.me/2024/09/22/problems-with-generic-code.html"></script>
  </div>
</article>

<style type="text/css">
  .author-title {
    text-align: center;
    color: #555;
  }

  .post-title {
    font-size: 4em;
    text-align: center;
  }

  .post-tags {
    text-align: center;
    margin-top: 3em;
    color: black;
  }

  .category {
    background-color: #2C3E50;
    padding: 5px 10px;
    border-radius: 20px;
    color: white;
  }

  .separator {
    margin: 50px auto;
  }

  hr {
    border-top: 1px solid #EEE;
  }
</style>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Gagandeep Singh ‚Äî Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Gagandeep Singh ‚Äî Blog</li><li><a class="u-email" href="mailto:gagan93gtbit@gmail.com">gagan93gtbit@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/gagan93jtg"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg> <span class="username">gagan93jtg</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Posts on Engineering, Culture, Leadership</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
